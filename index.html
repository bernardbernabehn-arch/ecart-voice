<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TDMH Full Audit v19</title>
    <style>
        :root { --hosp-blue: #1a73e8; --highlight: #e8f0fe; --staging-bg: #121212; }
        body { font-family: system-ui, sans-serif; background: #f8f9fa; margin: 0; overflow: hidden; }
        .assistant-header { background: var(--staging-bg); color: #00ff41; padding: 15px; text-align: center; border-bottom: 3px solid var(--hosp-blue); }
        #live-box { font-family: monospace; font-size: 1.4rem; min-height: 24px; text-transform: uppercase; }
        .mode-label { color: #888; font-size: 10px; letter-spacing: 2px; margin-bottom: 5px; }
        .viewport { height: calc(100vh - 180px); overflow-y: auto; padding: 10px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 5px; }
        tr { transition: all 0.2s ease; }
        td { background: white; padding: 12px 8px; border: 1px solid #eee; font-size: 13px; text-align: center; }
        td:first-child { text-align: left; width: 45%; font-weight: 600; border-radius: 8px 0 0 8px; }
        .row-active td { background: var(--highlight) !important; border-top: 2px solid var(--hosp-blue); border-bottom: 2px solid var(--hosp-blue); }
        .input-active { border: 2px solid var(--hosp-blue) !important; background: #fff !important; box-shadow: 0 0 8px rgba(26,115,232,0.5); }
        input { border: 1px solid #ccc; border-radius: 4px; padding: 6px; text-align: center; width: 60px; font-weight: bold; }
        .mic-btn { position: fixed; bottom: 20px; right: 20px; width: 70px; height: 70px; border-radius: 50%; background: var(--hosp-blue); color: white; border: none; font-size: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 999; }
    </style>
</head>
<body>

<div class="assistant-header">
    <div class="mode-label" id="status-msg">READY FOR 71-ITEM AUDIT</div>
    <div id="live-box">SAY "START" or TAP MIC</div>
</div>

<div class="viewport">
    <table><tbody id="audit-table"></tbody></table>
</div>

<button id="mic-btn" class="mic-btn" onclick="startAssistant()">ðŸŽ¤</button>

<script>
    // FULL COMPRESSED INVENTORY (71 ITEMS)
    const rawInv = "Adenosine 6mg|Amiodarone 150mg|Anti-tetanus serum|Aspirin 325mg|Atropine 1mg|Salbutamol Inhaler|Diazepam 10mg|Midazolam 5mg|Calcium Gluconate|Clopidogrel 75mg|D5W 250ml|D50W vial|Digoxin 0.5mg|Diphenhydramine|Dobutamine|Dopamine|Epinephrine 1mg|Furosemide 20mg|Haloperidol|Hydrocortisone|Lidocaine Spray|Lidocaine Sol|Magnesium Sulfate|Mannitol 20%|Methylprednisolone|Metoclopramide|Morphine (H.A)|Nitroglycerin|Noradrenaline|Paracetamol IV|Phenobarbital|Phenytoin|Plain LRS 1L|Plain NSS 1L|Potassium Chloride|Sodium Bicarb|Verapamil 5mg|Vitamin B Complex|Insulin syringe|1cc Syringe|3cc Syringe|5cc Syringe|10cc Syringe|20cc Syringe|30cc Syringe|50cc Syringe|Airway Adjuncts|Airway Kit|Alcohol|Aseptic bulb|Calculator|CBG Kit|Cardiac Board|ET Tube 2.5|ET Tube 3.0|ET Tube 3.5|ET Tube 4.0|ET Tube 4.5|ET Tube 5.0|ET Tube 5.5|ET Tube 6.0|ET Tube 6.5|ET Tube 7.0|ET Tube 7.5|ET Tube 8.0|ET Tube 8.5|Foley FR.14|Foley FR.16|Foley FR.18|Urine Bag|Waterproof Apron";
    const inv = rawInv.split('|');

    let currentIdx = 0, isQty = true, recognition;

    const tableBody = document.getElementById('audit-table');
    inv.forEach((name, i) => {
        const tr = document.createElement('tr');
        tr.id = `row-${i}`;
        tr.innerHTML = `<td>${name}</td>
            <td><input type="text" id="q-${i}" placeholder="Qty"></td>
            <td><input type="text" id="e-${i}" placeholder="Exp"></td>`;
        tableBody.appendChild(tr);
    });

    function startAssistant() {
        const Speech = window.webkitSpeechRecognition || window.SpeechRecognition;
        recognition = new Speech();
        recognition.continuous = true;
        recognition.interimResults = true;

        recognition.onresult = (event) => {
            let tr = '';
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                tr += event.results[i][0].transcript;
            }
            const speech = tr.toLowerCase();
            document.getElementById('live-box').innerText = speech;
            
            // VOICE COMMANDS
            if (speech.includes("skip")) { advanceRow(); return; }

            const target = isQty ? document.getElementById(`q-${currentIdx}`) : document.getElementById(`e-${currentIdx}`);
            if (isQty) {
                const n = speech.match(/\d+/);
                if (n) target.value = n[0];
            } else { target.value = speech; }

            if (event.results[event.results.length - 1].isFinal) {
                setTimeout(nextStep, 500);
            }
        };
        recognition.start();
        document.getElementById('mic-btn').style.background = "red";
        updateHighlight();
    }

    function nextStep() {
        if (isQty) { isQty = false; } else { isQty = true; currentIdx++; }
        checkAndMove();
    }

    function advanceRow() {
        isQty = true; currentIdx++;
        checkAndMove();
    }

    function checkAndMove() {
        if (currentIdx < inv.length) {
            updateHighlight();
            document.getElementById('live-box').innerText = "---";
        } else {
            document.getElementById('status-msg').innerText = "AUDIT FINISHED";
            recognition.stop();
        }
    }

    function updateHighlight() {
        document.querySelectorAll('tr').forEach(r => r.classList.remove('row-active'));
        document.querySelectorAll('input').forEach(i => i.classList.remove('input-active'));
        const row = document.getElementById(`row-${currentIdx}`);
        const input = isQty ? document.getElementById(`q-${currentIdx}`) : document.getElementById(`e-${currentIdx}`);
        row.classList.add('row-active');
        input.classList.add('input-active');
        document.getElementById('status-msg').innerText = `AUDITING: ${inv[currentIdx]}`;
        row.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
</script>
</body>
</html>
